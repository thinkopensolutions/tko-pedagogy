<?xml version="1.0" encoding="utf-8"?>
<openerp>
    <data>

        <record id="res_partner_inherited_form" model="ir.ui.view">
            <field name="name">res_partner_inherited_form</field>
            <field name="model">res.partner</field>
            <field name="inherit_id" ref="base.view_partner_form"/>
            <field name="arch" type="xml">
                <div class="oe_edit_only" position="replace">
                    <div class="oe_edit_only">
                        <field name="is_student" class="oe_inline"/>
                        <label for="is_student" string="Is Student?"/>
                        <field name="is_company" on_change="onchange_type(is_company)" class="oe_inline"/>
                        <label for="is_company" string="Is a Company?"/>
                    </div>
                </div>
                <field name="parent_id" position="replace">
                    <field name="parent_id"
                           placeholder="Company"
                           domain="[('is_company', '=', True)]" context="{'default_is_company': True}"
                           attrs="{'invisible': ['|',('is_company','=', True),('is_student','=', True)]}"
                           on_change="onchange_address(use_parent_address, parent_id)"/>
                </field>
                <field name="function" position="replace">
                    <field name="function" placeholder="e.g. Sales Director"
                           attrs="{'invisible': ['|',('is_company','=', True),('is_student','=', True)]}"/>
                </field>
                <field name="title" position="replace">
                    <field name="title" domain="[('domain', '=', 'contact')]"
                           options='{"no_open": True}'
                           attrs="{'invisible': ['|',('is_company','=', True),('is_student','=', True)]}"/>
                </field>
                <label for="street" position="before">
                    <separator string="Student" attrs="{'invisible': [('is_student','=', False)]}"/>
                    <group col="4" colspan="4" attrs="{'invisible': [('is_student','=', False)]}">
                        <field name="gender" colspan="4" attrs="{'required':[('is_student','=',True)]}"/>
                        <field name="age"/>
                        <field name="birth_date" on_change="onchange_birth_date(birth_date)"
                               attrs="{'required':[('is_student','=',True)]}" nolabel="1" colspan="2"/>
                        <field name="tutor_id" colspan="4"
                               domain="[('is_company', '=', False),('is_student', '=', False)]"
                               attrs="{'required':[('is_student','=',True)]}"/>
                    </group>
                    <separator string="Address"/>
                    <newline/>
                </label>
                <field name="phone" position="before">
                    <separator string="School" attrs="{'invisible': [('is_student','=', False)]}"/>
                    <group col="4" colspan="4" attrs="{'invisible': [('is_student','=', False)]}">
                        <field name="student_number" colspan="4"/>
                        <field name="enrollment_id" colspan="4"/>
                        <field name="year_coordinator_id" colspan="4"/>
                        <field name="group_coordinator_id" colspan="4"/>
                        <field name="class_coordinator_id" colspan="4"/>
                    </group>
                    <separator string="Contacts"/>
                    <newline/>
                </field>
                <label string="Address" position="before">
                    <field name="address_partner_id" on_change="onchange_address_partner_id(address_partner_id)"
                           domain="[('is_company', '=', False), ('is_student', '=', False)]"
                           attrs="{'invisible': [('is_company','=', True)]}"/>
                </label>
                <field name="website" position="replace"/>
                <field name="email" position="after">
                    <field name="website" widget="url" placeholder="e.g. www.colegio360.com"/>
                </field>
                <page string="Internal Notes" position="before">
                    <page string="Enrollments" attrs="{'invisible':[('is_student', '=', False)]}">
                        <separator string="Enrollments"/>
                        <field name="enrollment_ids" domain="[('state', '=', 'enrolled')]" nolabel="1" colspan="4"
                               context="{'default_student': active_id}" readonly="1">
                            <tree string="Enrollments" colors="green:state=='justified';red:state=='unjustified';">
                                <field name="number"/>
                                <field name="class_year_id"/>
                                <field name="state"/>
                            </tree>
                        </field>
                    </page>
                </page>
            </field>
        </record>

        <record id="res_partner_inherited_tree" model="ir.ui.view">
            <field name="name">res_partner_inherited_tree</field>
            <field name="model">res.partner</field>
            <field name="inherit_id" ref="base.view_partner_tree"/>
            <field name="arch" type="xml">
                <field name="name" position="before">
                    <field name="student_number"/>
                </field>
                <field name="name" position="after">
                    <field name="gender" invisible="1"/>
                    <field name="enrollment_id"/>
                    <field name="tutor_id"/>
                </field>
            </field>
        </record>

        <record id="res_partner_inherited_kanban" model="ir.ui.view">
            <field name="name">res_partner_inherited_kanban</field>
            <field name="model">res.partner</field>
            <field name="inherit_id" ref="base.res_partner_kanban_view"/>
            <field name="arch" type="xml">
                <li t-if="record.parent_id.raw_value and !record.function.raw_value" position="before">
                    <li t-if="record.student_number.raw_value">
                        <field name="student_number"/>
                    </li>
                    <li t-if="record.enrollment_id.raw_value">
                        <field name="enrollment_id"/>
                    </li>
                    <li t-if="record.tutor_id.raw_value">
                        <field name="tutor_id" context="{student_kanban: True}"/>
                    </li>
                </li>
            </field>
        </record>

        <record id="res_partner_inherited_search" model="ir.ui.view">
            <field name="name">res_partner_inherited_search</field>
            <field name="model">res.partner</field>
            <field name="inherit_id" ref="base.view_res_partner_filter"/>
            <field name="arch" type="xml">
                <field name="parent_id" position="after">
                    <field name="gender"/>
                    <field name="tutor_id"/>
                </field>
                <filter string="Customers" position="before">
                    <filter string="Students" name="is_student" domain="[('is_student','=',1)]" help="Students"/>
                </filter>
                <filter string="Salesperson" position="before">
                    <filter string="Gender" name="gender" context="{'group_by':'gender'}"/>
                    <filter string="Tutor" name="tutor_id" context="{'group_by':'tutor_id'}"/>
                </filter>
            </field>
        </record>

        <record id="res_partner_action" model="ir.actions.act_window">
            <field name="name">Students</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">res.partner</field>
            <field name="view_type">form</field>
            <field name="view_mode">kanban,tree,form</field>
            <field name="context">{'default_is_student':0,
                'default_customer':0,'search_default_is_student':1,'search_default_active':1}
            </field>
            <field name="view_id" ref="res_partner_inherited_kanban"/>
            <field name="search_view_id" ref="res_partner_inherited_search"/>
            <field name="help" type="html">
                <p class="oe_view_nocontent_create">
                    Click to add a student.
                </p>
            </field>
        </record>

        <menuitem
                id="menu_students"
                name="Students"
                action="res_partner_action"
                parent="menu_secretary" sequence="0"/>

    </data>
</openerp>
